/* v - 1.0.82
 * Â© Miles Nature 
 * Build time: 08-14-2020 21:46:47
 */
const html=document.getElementsByTagName("HTML")[0],body=document.body,bmkSection=document.getElementById("bookmarks"),errorMessage=document.getElementById("errorMessage"),footer=document.getElementsByTagName("footer")[0],modalHelp=document.getElementById("modelHelp"),loaderTemplate=document.getElementsByTagName("template")[0],urlCheck=/((http|ftp|https|file):\/\/)/,domainUrl=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"")+"/",allowDrop=e=>{e.preventDefault()},dragStart=e=>{const t=e.target,o=t.tagName?t.tagName:"",r=t.href?t.href:"",a=t.text?t.text:"",n=t.id?t.id:"";"A"===o&&(e.dataTransfer.setData("tag",o),e.dataTransfer.setData("href",r),e.dataTransfer.setData("text",a),e.dataTransfer.setData("id",n))},dragEnter=e=>{let t=e.target.closest("ul.bookmarks");e.preventDefault(),cleanupDragHover(),t.classList.add("drag-hover")},cleanupDragHover=()=>{let e=openGroup.getLists();removeBackgroundColor=((e,t)=>{e.classList.remove("drag-hover")}),e.forEach(removeBackgroundColor)},drop=e=>{e.preventDefault();let t=e.target,o=e.dataTransfer.getData("tag")?e.dataTransfer.getData("tag"):"",r=e.dataTransfer.getData("href")?e.dataTransfer.getData("href"):"",a=e.dataTransfer.getData("text")?e.dataTransfer.getData("text"):"",n=e.dataTransfer.getData("id")?e.dataTransfer.getData("id"):"",s=t.closest("ul.bookmarks").id.substr(1),l="A"===o&&r&&n,m=e=>urlCheck.test(r);""===o&&""===r&&(r=a,m()&&(form.actionFromFooter("create"),body.scrollTop=0,document.documentElement.scrollTop=0,form.urlText.value=r,form.groupSelect.value=s)),l&&m()&&(form.actionFromFooter("update"),body.scrollTop=0,document.documentElement.scrollTop=0,bookmarksSelect.value=n,form.updatePrefill(),form.groupText.value=s),cleanupDragHover()},addDropEvents=()=>{lists=openGroup.getLists(),addDrop=((e,t)=>{e.addEventListener("drop",e=>{drop(e)})}),lists.forEach(addDrop)},addDragEnterEvents=()=>{lists=openGroup.getLists(),addDragEnter=((e,t)=>{e.addEventListener("dragenter",e=>{dragEnter(e)})}),lists.forEach(addDragEnter)},openGroup={getLists:()=>Array.prototype.slice.call(document.getElementsByClassName("bookmarks")),openNewTab:(e,t,o)=>{window.open(e,"_blank"),window.focus()},getUrls:e=>{let t=[];return e.forEach((e,o,r)=>{t.push(e.firstChild.href)}),t},openTabs:e=>{let t=e.target,o=[],r=[],a=[];o=Array.prototype.slice.call(t.parentNode.children),r=Array.prototype.slice.call(o[1].getElementsByTagName("LI")),(a=openGroup.getUrls(r)).forEach(openGroup.openNewTab)},setupEventHandler:(e,t,o)=>{bmkSection.addEventListener("click",e=>{e.target.classList.contains("all")&&openGroup.openTabs(e)})}},form={container:document.forms[0],bookmark:document.getElementById("bookmark"),group:document.getElementById("group"),bookmarksSelect:document.getElementById("bookmarksSelect"),groupText:document.getElementById("groupText"),groupSelect:document.getElementById("groupSelect"),nameText:document.getElementById("nameText"),nameSelect:document.getElementById("nameSelect"),urlText:document.getElementById("urlText"),buttonSubmit:document.getElementById("submit"),updateBookmarkSelectValue:()=>bookmarksSelect.value,updateBookmarkSelectText:()=>bookmarksSelect.options.length>0?bookmarksSelect.options[bookmarksSelect.selectedIndex].text:"",groupValue:()=>groupText.value,groupSelectValue:()=>groupSelect.value,groupSelectText:()=>groupSelect.options.length>0?groupSelect.options[groupSelect.selectedIndex].text:"",titleValue:()=>nameText.value,titleSelectValue:()=>nameSelect.value,titleSelectText:()=>nameSelect.options.length>0?nameSelect.options[nameSelect.selectedIndex].text:"",urlValue:()=>urlText.value,actionValue:()=>document.querySelector('input[name="action"]:checked').value,elementValue:()=>document.querySelector('input[name="element"]:checked').value,removeClasses:(...e)=>{form.container.classList.remove(...e)},addClasses:(...e)=>{form.container.classList.add(...e)},updateButton:e=>{form.buttonSubmit.value=e},openClose:()=>{body.classList.toggle("edit"),body.classList.contains("edit")?(localStorage.setItem("form","open"),form.container.reset(),removeChildNodes(errorMessage)):localStorage.setItem("form","closed")},actionFromFooter:(e,t)=>{body.classList.contains("edit")||form.openClose(),document.querySelector("input[value="+e+"]").checked="checked",t?form.group.checked="checked":form.bookmark.checked="checked",form.actionState(),form.elementState()},updatePrefill:()=>{if(bookmarksArray.length>0){let e="",t=form.updateBookmarkSelectText(),o="",r=form.updateBookmarkSelectValue(),a=(t,a)=>{t._id===r&&(e=t.group,o=t.url)};bookmarksArray.forEach(a),form.groupText.value=e,form.nameText.value=t,form.urlText.value=o}},actionState:()=>{const e=form.actionValue();form.removeClasses("create","delete","update"),form.resetFields(),removeChildNodes(errorMessage),form.addClasses(e),form.updateButton(e),"update"===e&&(form.bookmark.checked="checked",form.updatePrefill())},elementState:()=>{const e=form.elementValue(),t=form.actionValue();form.removeClasses("bookmark","group"),removeChildNodes(errorMessage),form.addClasses(e),"update"!==t&&form.resetFields()},getStates:()=>{const e=form.actionValue(),t=form.elementValue();return{isCreate:"create"===e,isDelete:"delete"===e,isUpdate:"update"===e,isGroup:"group"===t,isBookmark:"bookmark"===t,action:e,element:t}},getValues:()=>{const e=form.getStates(),t={group:(()=>e.isGroup&&e.isCreate||e.isBookmark&&e.isUpdate?form.groupValue():e.isGroup&&e.isDelete||e.isBookmark&&e.isCreate?form.groupSelectText():"")(),id:(()=>e.isBookmark&&e.isDelete?form.titleSelectValue():e.isBookmark&&e.isUpdate?form.updateBookmarkSelectValue():"")(),name:(()=>e.isBookmark&&e.isDelete?form.titleSelectText():(e.isBookmark||e.isGroup)&&e.isCreate||e.isBookmark&&e.isUpdate?form.titleValue():"")(),url:(()=>(e.isBookmark||e.isGroup)&&e.isCreate||e.isBookmark&&e.isUpdate?form.urlValue():"")()};return{action:e.action,element:e.element,state:e,config:t}},resetFields:()=>{form.groupText.value="",form.nameText.value="",form.urlText.value=""},displayErrorMessage:(...e)=>{if(removeChildNodes(errorMessage),e)if(Array.isArray(e)&&e.length>0){let t=document.createDocumentFragment(),o=(e,o)=>{if(""===e)return;let r=document.createElement("LI"),a=document.createTextNode(e);r.appendChild(a),t.appendChild(r)};e.forEach(o),errorMessage.appendChild(t)}else{let t=document.createDocumentFragment(),o=document.createTextNode(e);t.appendChild(o),errorMessage.appendChild(t)}},formSubmit:e=>{e.preventDefault(),removeChildNodes(errorMessage);const t=form.getValues(),o=t.state,r={action:(()=>t.action?t.action&&t.action.length>25?"Action exceeds maximum character length of 25.":"":"Action is required.")(),element:(()=>t.element?t.element&&t.element.length>25?"Element exceeds maximum character length of 25.":"":"Element is required.")(),name:(()=>t.config.name?t.config.name.length>100?"Name exceeds maximum character length of 100.":"":"Name is required.")(),url:(()=>t.config.url?t.config.url.length>2083?"URL exceeds maximum character length of 2083.":!1===urlCheck.test(t.config.url)?"URL is invalid.":"":"URL is required.")(),group:(()=>t.config.group?t.config.group.length>100?"Group exceeds maximum character length of 100.":"":"Group is required.")(),id:(()=>t.config.id?t.config.id.length>25?"ID exceeds maximum character length of 25.":"":"ID is required.")()};let a="";""===r.action&&""===r.element?(o.isCreate&&(o.isBookmark||o.isGroup)&&(""===r.name&&""===r.url&&""===r.group?(a="name="+t.config.name+"&url="+t.config.url+"&group="+t.config.group,api.verbBookmark("POST",domainUrl+"bookmarks",a,api.getBookmarks)):form.displayErrorMessage(r.group,r.name,r.url)),o.isDelete&&o.isBookmark&&(""===r.id?api.verbBookmark("DELETE",domainUrl+"bookmarks/"+t.config.id,a,api.getBookmarks):form.displayErrorMessage(r.id)),o.isDelete&&o.isGroup&&(""===r.group?api.verbBookmark("DELETE",domainUrl+"bookmarks/group/"+t.config.group,a,api.getBookmarks):form.displayErrorMessage(r.group)),o.isUpdate&&o.isBookmark&&(""===r.name&&""===r.url&&""===r.group&&""===r.id?(a="name="+t.config.name+"&url="+t.config.url+"&group="+t.config.group,api.verbBookmark("PUT",domainUrl+"bookmarks/"+t.config.id,a,api.getBookmarks)):form.displayErrorMessage(r.group,r.name,r.url,r.id))):form.displayErrorMessage(r.action,r.element)}},bookmarks={sortGroup:(e,t)=>{const o=e.group;o&&(groupsByName.hasOwnProperty(o)?groupsByName[o].push(e):(groupsByName[o]=[e],groups.push(o)))},sortIntoGroups:e=>(groupsByName=[],groups=[],e.forEach(bookmarks.sortGroup),groupsByName),constructList:e=>{let t,o=document.createDocumentFragment(),r=item,a=document.createElement("UL"),n=document.createAttribute("class"),s=document.createAttribute("id"),l=document.createElement("LI"),m=document.createElement("BUTTON"),d=document.createAttribute("class"),c=document.createTextNode(r),i=document.createElement("UL");for(n.value="bookmarks",a.setAttributeNode(n),s.value="_"+r,a.setAttributeNode(s),d.value="all",m.setAttributeNode(d),m.appendChild(c),t=0;t<e.length;t+=1){let o=e[t];if(!o.group||!o.name||!o.url)continue;let r=document.createElement("LI"),a=document.createElement("A"),n=document.createAttribute("id"),s=document.createAttribute("href"),l=document.createAttribute("target"),m=document.createAttribute("rel"),d=document.createTextNode(o.name);n.value=o._id,a.setAttributeNode(n),s.value=o.url,a.setAttributeNode(s),l.value="_blank",a.setAttributeNode(l),m.value="noreferrer",a.setAttributeNode(m),a.appendChild(d),r.appendChild(a),i.appendChild(r)}return l.appendChild(m),l.appendChild(i),a.appendChild(l),o.appendChild(a),o},constructSection:()=>{let e=bookmarksArray,t=bookmarks.sortIntoGroups(e),o=document.createDocumentFragment();for(item in bookmarks.remove(),t)item&&(group=t[item],o.appendChild(bookmarks.constructList(group)));bmkSection.appendChild(o),openGroup.setupEventHandler(),bookmarks.constructGroupOptions(),bookmarks.constructNameOptions(t),form.resetFields(),removeChildNodes(errorMessage),lists=openGroup.getLists(),addDrop=((e,t)=>{e.addEventListener("drop",e=>{drop(e)})}),lists.forEach(addDrop),lists=openGroup.getLists(),addDragEnter=((e,t)=>{e.addEventListener("dragenter",e=>{dragEnter(e)})}),lists.forEach(addDragEnter)},remove:()=>{bmkSection.hasChildNodes()&&removeChildNodes(bmkSection)},constructGroupOptions:()=>{let e=document.createDocumentFragment();groups.forEach((t,o)=>{option=document.createElement("OPTION"),val=document.createAttribute("value"),text=document.createTextNode(t),val.value=t,option.setAttributeNode(val),option.appendChild(text),e.appendChild(option)}),form.groupSelect.hasChildNodes()&&removeChildNodes(form.groupSelect),form.groupSelect.appendChild(e)},constructNameOptions:(e,t)=>{let o=(()=>document.createDocumentFragment())(),r=[];for(item in e){if(!item)continue;r=e[item];let t=document.createDocumentFragment(),a=document.createElement("OPTGROUP"),n=document.createAttribute("label"),s=(e,o)=>{option=document.createElement("OPTION"),val=document.createAttribute("value"),text=document.createTextNode(e.name),val.value=e._id,option.setAttributeNode(val),option.appendChild(text),t.appendChild(option)};n.value=item,a.setAttributeNode(n),r.forEach(s),a.appendChild(t),o.appendChild(a)}form.nameSelect.hasChildNodes()&&removeChildNodes(form.nameSelect),form.bookmarksSelect.hasChildNodes()&&removeChildNodes(form.bookmarksSelect);let a=o.cloneNode(!0);form.nameSelect.appendChild(o),form.bookmarksSelect.appendChild(a),form.updatePrefill()},storage:{set:e=>{localStorage.setItem("bookmarks",e)},get:()=>{const e=localStorage.getItem("bookmarks");return e?JSON.parse(e):""}},toggleLoader:e=>{const t=bmkSection.querySelector("svg#loader");switch(e){case"remove":t&&bookmarks.remove();break;case"add":if(!t){const e=loaderTemplate.content.cloneNode(!0);bmkSection.appendChild(e)}}}},api={getBookmarks:()=>{const e=new XMLHttpRequest;e.onreadystatechange=function(){if(e.readyState===XMLHttpRequest.DONE){const t=e.status;(0===t||t>=200&&t<400)&&this.responseText?(bookmarksArray=JSON.parse(this.responseText),bookmarks.storage.set(this.responseText),bookmarksArray.length>0?bookmarks.constructSection():(form.actionFromFooter("create",!0),toggleModalHelp(),bookmarks.remove())):form.displayErrorMessage(this.responseText)}},e.open("GET",domainUrl+"bookmarks",!0),e.setRequestHeader("Content-type","application/x-www-form-urlencoded"),e.send()},verbBookmark:(e,t,o,r)=>{const a=new XMLHttpRequest;a.onreadystatechange=function(){if(a.readyState===XMLHttpRequest.DONE){const e=a.status;(0===e||e>=200&&e<400)&&this.responseText?(form.resetFields(),r()):form.displayErrorMessage(this.responseText)}},a.open(e,t,!0),a.setRequestHeader("Content-type","application/x-www-form-urlencoded"),a.send(o)}},removeChildNodes=e=>{if(e.hasChildNodes()){let t=e.lastElementChild;for(;t;)e.removeChild(t),t=e.lastElementChild}e.textContent.length&&(e.textContent="")},toggleModalHelp=()=>document.getElementsByClassName("modal")[0].classList.toggle("show");let bookmarksArray=[],groupsByName=[],groups=[];window.onload=(()=>{bookmarks.toggleLoader("add");let e=bookmarks.storage.get();e&&(bookmarksArray=e,bookmarks.constructSection()),api.getBookmarks(),"open"===localStorage.getItem("form")&&(body.classList.contains("edit")||form.openClose()),form.container.addEventListener("change",e=>{const t=e.target,o=t.tagName,r=t.name;switch(o){case"INPUT":switch(r){case"action":form.actionState(),form.elementState();break;case"element":form.elementState()}break;case"SELECT":"name_select"===r&&form.updatePrefill()}}),form.container.addEventListener("click",e=>{const t=e.target,o=t.tagName,r=t.name;switch(o){case"INPUT":"submit"===r&&form.formSubmit(e);break;case"BUTTON":case"svg":case"polyline":case"path":form.openClose()}}),footer.addEventListener("click",e=>{const t=e.target,o=t.tagName,r=t.id,a=t.className;switch(o){case"BUTTON":form.actionFromFooter(a),body.scrollTop=0,document.documentElement.scrollTop=0;break;case"A":"help"===r&&toggleModalHelp()}}),modelHelp.addEventListener("click",e=>{const t=e.target,o=t.tagName,r=t.className;"A"===o&&"close"===r&&toggleModalHelp()});const t=new Date;document.getElementById("year").innerText=t.getFullYear(),html.addEventListener("dragover",e=>{allowDrop(e)}),html.addEventListener("dragstart",e=>{dragStart(e)})});
